import{T as e,w as t}from"./react-query-Bs2h8zdQ.js";import{l as n,u as r}from"./vendor-react-g7Jl8uRT.js";import{C as i,S as a,b as o,g as s,w as c}from"./index-DnojQBUd.js";import{r as l,t as u}from"./formatters-QxNcvdBP.js";import{t as d}from"./BaseModal-gkdyOWux.js";import{t as f}from"./CustomSelect-D8GRaeAY.js";import"./sanitizers-BTIJ-cE9.js";import"./commitmentQuery-Iodg7j_6.js";import"./queryInvalidationService-hpRcjput.js";import{t as p}from"./useCommitment-CEEZljwE.js";import{a as m,i as h,n as g,o as _,r as v,s as y,t as b}from"./useValidation-B3WMBN_b.js";import"./pt-BR-CwF-q4-j.js";import{t as x}from"./DateField-BbN-VAiT.js";import{t as S}from"./MonthField-BPD2zaMv.js";var C=e();const w=_({description:y().trim().min(1,`A Descrição é obrigatória`),category:y().min(1,`A Categoria é obrigatória`),type:v([`Fixo`,`Variável`,`Cartão`],{message:`O Tipo é obrigatório`}),referenceMonth:y().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:m().positive(`O Valor é obrigatório`),months:m().int().positive().optional().default(1),dueDate:g({message:`A Data de vencimento é obrigatória`})}),T=_({description:y().trim().min(1,`A Descrição é obrigatória`),category:y().min(1,`A Categoria é obrigatória`),type:h(`Cartão`),card:y().min(1,`O Cartão é obrigatório`),referenceMonth:y().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:m().positive(`O Valor é obrigatório`),totalInstallments:m().int(`As Parcelas devem ser um número inteiro`).positive(`As Parcelas devem ser um número positivo`),dueDate:g({message:`A Data de vencimento é obrigatória`})});var E=t(),D={description:``,category:``,type:``,dueDate:``,months:1,card:``,amount:``,totalInstallments:1,referenceMonth:``};function O({isOpen:e,onClose:t}){let{month:m,year:h}=s(),{create:g,createCard:_,isSaving:v}=p(m,String(h)),y=o(),{validate:O}=b(),{control:k,register:A,handleSubmit:j,watch:M,setValue:N,reset:P}=r({defaultValues:D}),F=M(`type`),I=M(`dueDate`);(0,C.useEffect)(()=>{F===`Fixo`&&I&&N(`months`,12-new Date(I).getMonth())},[F,I]),(0,C.useEffect)(()=>{e||P(D)},[e,P]),(0,C.useEffect)(()=>{if(!e)return;let t=new Date,n=m===`all`?t.getMonth()+1:Number(m);N(`referenceMonth`,`${m===`all`?t.getFullYear():h}-${String(n).padStart(2,`0`)}`)},[e,m,h,N]);async function L(e){if(F===`Cartão`){let t=O(T,{description:e.description,category:e.category,type:F,card:e.card,amount:u(String(e.amount)),totalInstallments:Number(e.totalInstallments),dueDate:e.dueDate,referenceMonth:e.referenceMonth});if(!t)return;await _(t),y.success(`Compromisso de cartão criado com sucesso!`)}else{let t=O(w,{description:e.description,category:e.category,type:F,amount:u(String(e.amount)),dueDate:e.dueDate,months:F===`Fixo`?e.months:1,referenceMonth:e.referenceMonth});if(!t)return;await g(t),y.success(`Compromisso criado com sucesso!`)}P(D),t()}return(0,E.jsx)(d,{isOpen:e,onClose:t,title:`Novo compromisso`,type:`create`,isLoading:v,loadingText:`Salvando...`,onSave:j(L),children:(0,E.jsxs)(`div`,{className:`space-y-4`,children:[(0,E.jsxs)(`div`,{className:`grid grid-cols-1 gap-4`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,E.jsx)(`input`,{id:`commitment-description`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                        dark:text-gray-100 rounded-md p-2`,placeholder:`Ex: Aluguel, Parcela Notebook`,...A(`description`)})]}),(0,E.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{id:`commitment-category-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Categoria *`}),(0,E.jsx)(n,{name:`category`,control:k,render:({field:e})=>(0,E.jsx)(f,{id:`commitment-category`,label:`Categoria`,value:e.value,onChange:e.onChange,options:i})})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{id:`commitment-type-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Tipo *`}),(0,E.jsx)(n,{name:`type`,control:k,render:({field:e})=>(0,E.jsx)(f,{id:`commitment-type`,label:`Tipo de compromisso`,value:e.value,onChange:t=>e.onChange(t),options:c})})]})]})]}),(0,E.jsx)(`hr`,{className:`border-dashed`}),(F===`Fixo`||F===`Variável`)&&(0,E.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,E.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,E.jsx)(n,{name:`amount`,control:k,render:({field:e})=>(0,E.jsx)(`input`,{...e,id:`commitment-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(l(t.target.value))})})]}),F===`Fixo`&&(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,E.jsx)(`input`,{id:`commitment-months`,"aria-label":`Número de meses para repetir o compromisso`,autoComplete:`off`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...A(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-due-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Vencimento *`}),(0,E.jsx)(n,{control:k,name:`dueDate`,render:({field:e})=>(0,E.jsx)(x,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,E.jsx)(n,{control:k,name:`referenceMonth`,render:({field:e})=>(0,E.jsx)(S,{value:e.value,onChange:e.onChange})})]})]}),F===`Cartão`&&(0,E.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{id:`commitment-card-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Selecione o Cartão *`}),(0,E.jsx)(n,{name:`card`,control:k,render:({field:e})=>(0,E.jsx)(f,{id:`commitment-card`,label:`Cartão de crédito`,value:e.value??``,onChange:e.onChange,options:a})})]}),(0,E.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-total-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor Total *`}),(0,E.jsx)(n,{name:`amount`,control:k,render:({field:e})=>(0,E.jsx)(`input`,{id:`commitment-total-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(l(t.target.value))})})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{htmlFor:`commitment-total-installments`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Parcelas *`}),(0,E.jsx)(`input`,{id:`compromisso-total-parcelas`,min:1,max:60,"aria-required":`true`,autoComplete:`off`,"aria-label":`Total de parcelas do compromisso`,type:`number`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...A(`totalInstallments`)})]})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Primeiro Vencimento *`}),(0,E.jsx)(n,{control:k,name:`dueDate`,render:({field:e})=>(0,E.jsx)(x,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,E.jsxs)(`div`,{children:[(0,E.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,E.jsx)(n,{control:k,name:`referenceMonth`,render:({field:e})=>(0,E.jsx)(S,{value:e.value,onChange:e.onChange})})]})]})]})})}export{O as default};