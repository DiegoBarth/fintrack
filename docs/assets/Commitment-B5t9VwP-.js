import{T as e,w as t}from"./react-query-B5bzpzJa.js";import{b as n,n as r,r as i,s as a}from"./vendor-react-u-2Pnofo.js";import{c as o,i as s,o as c,s as l}from"./index-BeZ-GXZY.js";import"./createLucideIcon-DIUIV8YK.js";import{n as u,t as d}from"./Layout-mXL8prcx.js";import"./chevron-right-DzDQO_nA.js";import{a as f,c as p,d as m,f as h,g,h as _,i as v,l as y,m as b,n as x,o as S,p as C,r as w,s as T,t as ee,u as E}from"./SkeletonList-CU6q3gYl.js";import{t as D}from"./plus-_D9Bpsd5.js";import{t as O}from"./wallet-C9G11fzg.js";import"./x-DKWcFa7g.js";import{i as k,n as A}from"./PeriodContext-j9ZXP6ex.js";import{n as j,r as M,s as N,t as P}from"./formatters-DVAU20Gu.js";import{n as F,r as te,t as I}from"./DateField-C-M_oAib.js";import"./clsx-C7a_t6ND.js";import{t as L}from"./utils-DFP6x-mX.js";import"./ConfirmModal-DSNM3NTe.js";import"./ScopeChoiceModal-DeYDEXY8.js";import{t as R}from"./EditCommitmentModal-Bb2vWp0G.js";import"./Skeleton-D5FaXslB.js";import{n as z,t as B}from"./CustomSelect-QYv0Scb-.js";import{t as V}from"./MonthField-C1cE5TiA.js";var H=e(),U=t();function W(e){let[t,n,r]=e.split(`/`).map(Number),i=new Date(r,n-1,t);i.setHours(0,0,0,0);let a=new Date;return a.setHours(0,0,0,0),i<a}const G=(0,H.memo)(function({commitments:e,onSelect:t}){return(0,U.jsx)(g,{itens:e,emptyText:`Nenhum compromisso cadastrado`,keyExtractor:e=>e.rowIndex,renderMobileItem:(0,H.useCallback)(e=>{let n=!!e.paymentDate,r=e.type===`Cartão`,i=!n&&W(e.dueDate);return(0,U.jsxs)(_,{onClick:()=>t(e),variant:n?`success`:i?`danger`:`warning`,className:`p-3`,children:[(0,U.jsx)(b,{title:e.description,right:N(e.amount)}),(0,U.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground ${r?`min-h-[1rem]`:``}`,children:r?(0,U.jsxs)(`span`,{children:[e.card,(e.totalInstallments??1)>1&&(0,U.jsxs)(U.Fragment,{children:[` • Parcela `,e.installment,`/`,e.totalInstallments]})]}):(0,U.jsx)(`span`,{children:e.type})}),(0,U.jsx)(C,{left:(0,U.jsxs)(`div`,{className:`flex flex-col text-xs mt-1`,children:[(0,U.jsxs)(`span`,{className:i?`text-red-700 dark:text-red-300`:`text-amber-700 dark:text-amber-400`,children:[`Vence em `,e.dueDate]}),(0,U.jsx)(`span`,{className:`text-green-700 dark:text-green-400 ${n?``:`invisible select-none`}`,children:n?`Pago em ${e.paymentDate}`:`Aguardando`})]}),right:(0,U.jsx)(`div`,{className:`flex flex-col items-end gap-1`,children:(0,U.jsx)(`span`,{className:`font-medium text-sm
                           ${n&&`text-green-700 dark:text-green-400`}
                           ${i&&`text-red-600 dark:text-red-400`}
                           ${!n&&!i&&`text-amber-700 dark:text-amber-400`}
                        `,children:n?`Pago`:i?`Vencido`:`Em aberto`})})})]})},[t]),renderDesktopItem:(0,H.useCallback)(e=>{let n=!!e.paymentDate,r=!n&&W(e.dueDate);return(0,U.jsxs)(h,{onClick:()=>t(e),variant:n?`success`:r?`danger`:`default`,children:[(0,U.jsx)(m,{children:e.description}),(0,U.jsx)(E,{span:2,children:e.type}),(0,U.jsx)(E,{span:2,children:(0,U.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400`:r?`text-red-700 dark:text-red-300`:`text-amber-700 dark:text-amber-400`,children:n?`Pago em ${e.paymentDate}`:`Vence em ${e.dueDate}`})}),(0,U.jsx)(y,{children:N(e.amount)}),(0,U.jsx)(z,{children:(0,U.jsx)(`span`,{className:`font-semibold
                     ${n&&`text-green-700 dark:text-green-400`}
                     ${r&&`text-red-600 dark:text-red-400`}
                     ${!n&&!r&&`text-amber-700 dark:text-amber-400`}
                  `,children:n?`Pago`:r?`Vencido`:`Aberto`})})]})},[t])})});function K(e){return[...e].sort((e,t)=>{let n=new Date(j(e.dueDate)).getTime(),r=new Date(j(t.dueDate)).getTime();if(n!==r)return n-r;let i=e.totalInstallments??1;return(t.totalInstallments??1)-i})}var q=[`Fixo`,`Variável`,`Cartão`];const J=(0,H.memo)(function({commitments:e,onSelect:t,showStatementInGroupHeaders:n=!1}){let r=(0,H.useMemo)(()=>{let t={Fixo:[],Variável:[],Cartão:[]};for(let n of e){let e=n.type===`Fixo`||n.type===`Variável`||n.type===`Cartão`?n.type:`Variável`;t[e]&&t[e].push(n)}let n=[];for(let e of q){let r=t[e];if(r.length===0)continue;if(e!==`Cartão`){n.push({type:e,items:r});continue}let i={};for(let e of r){let t=e.card||`Outros`;i[t]||(i[t]=[]),i[t].push(e)}for(let e of c){let t=i[e];t?.length&&n.push({type:`Cartão`,card:e,items:K(t)})}i.Outros?.length&&n.push({type:`Cartão`,card:`Outros`,items:K(i.Outros)})}return n},[e]);return r.length===0?(0,U.jsx)(G,{commitments:[],onSelect:()=>{}}):(0,U.jsx)(`div`,{className:`space-y-6`,children:r.map(e=>{e.type===`Cartão`&&e.card;let r=n?e.items.reduce((e,t)=>e+Number(t.amount),0):0;return(0,U.jsxs)(`section`,{"aria-labelledby":`group-${e.type}-${e.card??``}`,children:[(0,U.jsxs)(`h2`,{id:`group-${e.type}-${e.card??``}`,className:`text-sm font-semibold text-muted-foreground mb-2 px-0.5 flex flex-wrap items-baseline justify-between gap-2`,children:[(0,U.jsx)(`span`,{children:e.card?`${e.type} • ${e.card}`:e.type}),n&&r>0&&(0,U.jsx)(`span`,{className:`font-bold text-foreground text-base`,children:N(r)})]}),(0,U.jsx)(G,{commitments:e.items,onSelect:t})]},e.card?`${e.type}-${e.card}`:e.type)})})});function Y({value:e,onChange:t,className:n}){return(0,U.jsxs)(`div`,{className:L(`flex flex-wrap items-center gap-2`,n),role:`group`,"aria-label":`Filtrar por tipo`,children:[(0,U.jsx)(X,{label:`Todos`,selected:e===null,onClick:()=>t(null)}),o.map(n=>(0,U.jsx)(X,{label:n,selected:e===n,onClick:()=>t(n)},n))]})}function X({label:e,selected:t,onClick:n}){return(0,U.jsx)(`button`,{type:`button`,onClick:n,className:L(`rounded-full px-3 py-1.5 text-sm font-medium transition-all duration-200`,`border focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background`,t?`bg-primary text-primary-foreground border-primary shadow-sm`:`bg-background border-border text-muted-foreground hover:bg-accent hover:text-accent-foreground hover:border-accent`),children:e})}function Z({value:e,onChange:t,className:n}){return(0,U.jsxs)(`div`,{className:L(`flex flex-wrap items-center gap-2`,n),role:`group`,"aria-label":`Filtrar por cartão`,children:[(0,U.jsx)(Q,{label:`Todos`,selected:e===null,onClick:()=>t(null)}),c.map(n=>(0,U.jsx)(Q,{label:n,selected:e===n,onClick:()=>t(n)},n))]})}function Q({label:e,selected:t,onClick:n}){return(0,U.jsx)(`button`,{type:`button`,onClick:n,className:L(`rounded-full px-3 py-1.5 text-sm font-medium transition-all duration-200`,`border focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background`,t?`bg-primary text-primary-foreground border-primary shadow-sm`:`bg-background border-border text-muted-foreground hover:bg-accent hover:text-accent-foreground hover:border-accent`),children:e})}function ne({cardName:e,totalStatement:t,onPayStatement:n,isPaying:r,allPaid:i=!1}){return(0,U.jsxs)(`div`,{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-xl border border-border bg-card text-card-foreground shadow-sm`,role:`region`,"aria-label":`Fatura do cartão ${e}`,children:[(0,U.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,U.jsx)(`div`,{className:`flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary`,children:(0,U.jsx)(O,{className:`h-5 w-5`})}),(0,U.jsxs)(`div`,{children:[(0,U.jsxs)(`p`,{className:`text-sm font-medium text-muted-foreground`,children:[`Fatura `,e]}),(0,U.jsx)(`p`,{className:`text-xl font-bold text-foreground`,children:N(t)})]})]}),(0,U.jsx)(u,{onClick:n,disabled:r||i,className:i?`rounded-full bg-muted text-muted-foreground border border-border shrink-0 cursor-default`:`rounded-full bg-green-600 hover:bg-green-700 text-white border-0 shrink-0`,children:r?`Pagando…`:i?`Pago`:`Pagar fatura`})]})}const re=T({description:p().trim().min(1,`A Descrição é obrigatória`),category:p().min(1,`A Categoria é obrigatória`),type:v([`Fixo`,`Variável`,`Cartão`],{message:`O Tipo é obrigatório`}),referenceMonth:p().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:S().positive(`O Valor é obrigatório`),months:S().int().positive().optional().default(1),dueDate:w({message:`A Data de vencimento é obrigatória`})}),ie=T({description:p().trim().min(1,`A Descrição é obrigatória`),category:p().min(1,`A Categoria é obrigatória`),type:f(`Cartão`),card:p().min(1,`O Cartão é obrigatório`),referenceMonth:p().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:S().positive(`O Valor é obrigatório`),totalInstallments:S().int(`As Parcelas devem ser um número inteiro`).positive(`As Parcelas devem ser um número positivo`),dueDate:w({message:`A Data de vencimento é obrigatória`})});var $={description:``,category:``,type:``,dueDate:``,months:1,card:``,amount:``,totalInstallments:1,referenceMonth:``};function ae({isOpen:e,onClose:t}){let{month:n,year:a}=A(),{create:u,createCard:d,isSaving:f}=k(n,String(a)),p=s(),{validate:m}=x(),{control:h,register:g,handleSubmit:_,watch:v,setValue:y,reset:b}=i({defaultValues:$}),S=v(`type`),C=v(`dueDate`);(0,H.useEffect)(()=>{S===`Fixo`&&C&&y(`months`,12-new Date(C).getMonth())},[S,C]),(0,H.useEffect)(()=>{e||b($)},[e,b]),(0,H.useEffect)(()=>{if(!e)return;let t=new Date,r=n===`all`?t.getMonth()+1:Number(n);y(`referenceMonth`,`${n===`all`?t.getFullYear():a}-${String(r).padStart(2,`0`)}`)},[e,n,a,y]);async function w(e){if(S===`Cartão`){let t=m(ie,{description:e.description,category:e.category,type:S,card:e.card,amount:P(String(e.amount)),totalInstallments:Number(e.totalInstallments),dueDate:e.dueDate,referenceMonth:e.referenceMonth});if(!t)return;await d(t),p.success(`Compromisso de cartão criado com sucesso!`)}else{let t=m(re,{description:e.description,category:e.category,type:S,amount:P(String(e.amount)),dueDate:e.dueDate,months:S===`Fixo`?e.months:1,referenceMonth:e.referenceMonth});if(!t)return;await u(t),p.success(`Compromisso criado com sucesso!`)}b($),t()}return(0,U.jsx)(te,{isOpen:e,onClose:t,title:`Novo compromisso`,type:`create`,isLoading:f,loadingText:`Salvando...`,onSave:_(w),children:(0,U.jsxs)(`div`,{className:`space-y-4`,children:[(0,U.jsxs)(`div`,{className:`grid grid-cols-1 gap-4`,children:[(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,U.jsx)(`input`,{id:`commitment-description`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                        dark:text-gray-100 rounded-md p-2`,placeholder:`Ex: Aluguel, Parcela Notebook`,...g(`description`)})]}),(0,U.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{id:`commitment-category-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Categoria *`}),(0,U.jsx)(r,{name:`category`,control:h,render:({field:e})=>(0,U.jsx)(B,{id:`commitment-category`,label:`Categoria`,value:e.value,onChange:e.onChange,options:l})})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{id:`commitment-type-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Tipo *`}),(0,U.jsx)(r,{name:`type`,control:h,render:({field:e})=>(0,U.jsx)(B,{id:`commitment-type`,label:`Tipo de compromisso`,value:e.value,onChange:t=>e.onChange(t),options:o})})]})]})]}),(0,U.jsx)(`hr`,{className:`border-dashed`}),(S===`Fixo`||S===`Variável`)&&(0,U.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,U.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,U.jsx)(r,{name:`amount`,control:h,render:({field:e})=>(0,U.jsx)(`input`,{...e,id:`commitment-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(M(t.target.value))})})]}),S===`Fixo`&&(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,U.jsx)(`input`,{id:`commitment-months`,"aria-label":`Número de meses para repetir o compromisso`,autoComplete:`off`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...g(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-due-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Vencimento *`}),(0,U.jsx)(r,{control:h,name:`dueDate`,render:({field:e})=>(0,U.jsx)(I,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,U.jsx)(r,{control:h,name:`referenceMonth`,render:({field:e})=>(0,U.jsx)(V,{value:e.value,onChange:e.onChange})})]})]}),S===`Cartão`&&(0,U.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{id:`commitment-card-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Selecione o Cartão *`}),(0,U.jsx)(r,{name:`card`,control:h,render:({field:e})=>(0,U.jsx)(B,{id:`commitment-card`,label:`Cartão de crédito`,value:e.value??``,onChange:e.onChange,options:c})})]}),(0,U.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-total-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor Total *`}),(0,U.jsx)(r,{name:`amount`,control:h,render:({field:e})=>(0,U.jsx)(`input`,{id:`commitment-total-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(M(t.target.value))})})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{htmlFor:`commitment-total-installments`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Parcelas *`}),(0,U.jsx)(`input`,{id:`compromisso-total-parcelas`,min:1,max:60,"aria-required":`true`,autoComplete:`off`,"aria-label":`Total de parcelas do compromisso`,type:`number`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...g(`totalInstallments`)})]})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Primeiro Vencimento *`}),(0,U.jsx)(r,{control:h,name:`dueDate`,render:({field:e})=>(0,U.jsx)(I,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,U.jsxs)(`div`,{children:[(0,U.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,U.jsx)(r,{control:h,name:`referenceMonth`,render:({field:e})=>(0,U.jsx)(V,{value:e.value,onChange:e.onChange})})]})]})]})})}function oe(){let{month:e,year:t}=A(),{commitments:r,isLoading:i,payCardStatement:o}=k(e,String(t)),[s,c]=(0,H.useState)(null),[l,u]=(0,H.useState)(!1),[f,p]=(0,H.useState)(null),[m,h]=(0,H.useState)(null),[g,_]=(0,H.useState)(!1),v=n(),y=()=>v(`/`),b=(0,H.useCallback)(e=>{p(e),e!==`Cartão`&&h(null)},[]),x=(0,H.useMemo)(()=>{let e=r;return f&&(e=e.filter(e=>e.type===f)),f===`Cartão`&&m&&(e=e.filter(e=>e.card===m)),e},[r,f,m]),S=(0,H.useMemo)(()=>x.filter(e=>!e.paymentDate),[x]),C=(0,H.useMemo)(()=>x.reduce((e,t)=>e+Number(t.amount),0),[x]),w=S.length===0,T=(0,H.useMemo)(()=>{let n=e===`all`?String(t):a(new Date(Number(t),Number(e)-1,1),`MMMM 'de' yyyy`,{locale:F});return`${e===`all`?n:n.charAt(0).toUpperCase()+n.slice(1)} • Total: ${N(x.reduce((e,t)=>e+Number(t.amount),0))}`},[e,t,x]),E=(0,H.useCallback)(async()=>{if(S.length===0)return;let e=new Date().toISOString().slice(0,10);_(!0);try{await o({rowIndexes:S.map(e=>e.rowIndex),paymentDate:e})}catch{}finally{_(!1)}},[S,o]);return i?(0,U.jsx)(d,{title:`Compromissos`,onBack:y,children:(0,U.jsx)(ee,{})}):(0,U.jsxs)(d,{title:`Compromissos`,onBack:y,subtitle:T,headerVariant:`commitment`,children:[(0,U.jsxs)(`div`,{className:`space-y-4 pb-20`,children:[(0,U.jsxs)(`div`,{className:`space-y-3 pb-3 border-b border-border`,children:[(0,U.jsx)(Y,{value:f,onChange:b}),f===`Cartão`&&(0,U.jsx)(Z,{value:m,onChange:h})]}),f===`Cartão`&&m&&(0,U.jsx)(ne,{cardName:m,totalStatement:C,onPayStatement:E,isPaying:g,allPaid:w}),(0,U.jsx)(J,{commitments:x,onSelect:c,showStatementInGroupHeaders:!m})]}),(0,U.jsx)(`button`,{type:`button`,onClick:()=>u(!0),className:`fixed bottom-6 right-6 z-50 flex h-14 w-14 items-center justify-center rounded-full bg-amber-600 text-white shadow-lg transition-all hover:bg-amber-700 dark:bg-amber-500 dark:hover:bg-amber-600 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900`,"aria-label":`Novo compromisso`,children:(0,U.jsx)(D,{className:`h-7 w-7`})}),(0,U.jsx)(ae,{isOpen:l,onClose:()=>u(!1)}),(0,U.jsx)(R,{isOpen:!!s,commitment:s,onClose:()=>c(null),onConfirm:()=>{}})]})}export{oe as default};