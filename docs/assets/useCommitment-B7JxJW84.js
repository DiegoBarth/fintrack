import{i as e,n as t,t as n}from"./react-query-Bs2h8zdQ.js";import{a as r,n as i}from"./formatters-QxNcvdBP.js";import{a,i as o,n as s,o as c,r as l,s as u,t as d}from"./commitmentQuery-D58d_Hoe.js";import{n as f,t as p}from"./queryInvalidationService-CcomgyDE.js";function m(e,t,n){e.setQueryData(d(n),e=>(e?[...e,t]:[t]).sort((e,t)=>{let n=new Date(i(e.dueDate)),r=new Date(i(t.dueDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()})),p(e)}function h(e,t,n,r){e.setQueryData(d(r),e=>e?.map(e=>e.rowIndex===t.rowIndex?{...e,...n}:e)??[]),p(e)}function g(e,t,n){e.setQueryData(d(n),e=>{if(!e)return[];let n=new Set(t.map(e=>e.rowIndex));return e.filter(e=>!n.has(e.rowIndex)).map(e=>{let n=t.filter(t=>t.rowIndex<e.rowIndex).length;return{...e,rowIndex:e.rowIndex-n}}).sort((e,t)=>{let n=new Date(i(e.dueDate)),r=new Date(i(t.dueDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()})}),p(e)}function _(i,d){let p=e(),{handleError:_}=f(),{data:v=[],isLoading:y,isError:b}=t(s(d)),x=i===`all`?v:v.filter(e=>{let{month:t}=r(e.referenceMonth);return String(t)===String(i)}),S=v,C=n({mutationFn:o,onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth);m(p,e,t)})},onError:_}),w=n({mutationFn:l,onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth);m(p,e,t)})},onError:_}),T=n({mutationFn:u,onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth),n=p.getQueryData([`commitments`,t])?.find(t=>t.rowIndex===e.rowIndex);n&&h(p,n,e,t)})},onError:_}),E=n({mutationFn:c,onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth),n=p.getQueryData([`commitments`,t])?.find(t=>t.rowIndex===e.rowIndex);n&&h(p,n,e,t)})},onError:_}),D=n({mutationFn:e=>typeof e==`number`?a(e):a(e.rowIndex,e.scope),onSuccess:e=>{if(!e?.length)return;let t=new Map;e.forEach(e=>{let{year:n}=r(e.referenceMonth),i=t.get(n)??[];i.push(e),t.set(n,i)}),t.forEach((e,t)=>{g(p,e,t)})},onError:_});return{commitments:x,alertCommitments:S,isLoading:y,isError:b,create:C.mutateAsync,createCard:w.mutateAsync,update:T.mutateAsync,payCardStatement:E.mutateAsync,remove:D.mutateAsync,isSaving:C.isPending||w.isPending||T.isPending||E.isPending,isDeleting:D.isPending}}export{_ as t};