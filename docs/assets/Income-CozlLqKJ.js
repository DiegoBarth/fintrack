import{T as e,w as t}from"./react-query-B5bzpzJa.js";import{b as n,n as r,r as i,s as a}from"./vendor-react-u-2Pnofo.js";import{i as o}from"./index-CMTXg1f_.js";import"./createLucideIcon-DIUIV8YK.js";import{t as s}from"./Layout-zGcGYpHc.js";import"./chevron-right-DzDQO_nA.js";import{c,d as l,f as u,g as d,h as f,l as p,m,n as h,o as g,p as _,r as v,s as y,t as b,u as x}from"./SkeletonList-fXsGw8RP.js";import{t as S}from"./plus-_D9Bpsd5.js";import{n as C,o as w}from"./PeriodContext-BJpVKQA4.js";import{c as T,n as E,r as D,s as O,t as k}from"./formatters-DVAU20Gu.js";import{n as A,r as j,t as M}from"./DateField-C-M_oAib.js";import"./clsx-C7a_t6ND.js";import"./utils-DFP6x-mX.js";import{t as N}from"./ScopeChoiceModal-DeYDEXY8.js";import"./Skeleton-D5FaXslB.js";import{t as P}from"./MonthField-C1cE5TiA.js";var F=e(),I=t();const L=(0,F.memo)(function({incomes:e,onSelect:t}){return(0,I.jsx)(d,{itens:e,emptyText:`Nenhuma receita cadastrada`,keyExtractor:e=>e.rowIndex,renderMobileItem:(0,F.useCallback)(e=>{let n=!!e.receivedDate;return(0,I.jsxs)(f,{onClick:()=>t(e),variant:n?`success`:`default`,className:`p-3`,children:[(0,I.jsx)(m,{title:e.description,right:O(e.amount)}),(0,I.jsx)(_,{left:(0,I.jsxs)(`div`,{className:`flex flex-col text-xs min-h-[32px] justify-center gap-1`,children:[e.expectedDate&&(0,I.jsxs)(`span`,{className:`text-blue-700 dark:text-blue-300`,children:[`Previsto para `,e.expectedDate]}),e.receivedDate?(0,I.jsxs)(`span`,{className:`text-green-700 dark:text-green-300`,children:[`Recebido em `,e.receivedDate]}):(0,I.jsx)(`span`,{className:`invisible select-none`,children:`Espaçador`})]}),right:(0,I.jsx)(`div`,{className:`flex flex-col items-end gap-1`,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400 font-medium`:`text-blue-700 dark:text-blue-400 font-medium`,children:n?`Recebido`:`Em aberto`})})})]})},[t]),renderDesktopItem:(0,F.useCallback)(e=>{let n=!!e.receivedDate,r=n?`Recebido em ${e.receivedDate}`:`Previsto para ${e.expectedDate}`;return(0,I.jsxs)(u,{onClick:()=>t(e),variant:n?`success`:`default`,children:[(0,I.jsx)(l,{children:e.description}),(0,I.jsx)(x,{span:4,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-300`:`text-blue-700 dark:text-blue-300`,children:r})}),(0,I.jsx)(p,{children:O(e.amount)}),(0,I.jsx)(`div`,{className:`col-span-2 text-right flex justify-end items-center gap-2`,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400 font-semibold`:`text-blue-700 dark:text-blue-400 font-semibold`,children:n?`Recebido`:`Em aberto`})})]})},[t])})}),R=y({description:c().trim().min(1,`A Descrição é obrigatória`),amount:g().positive(`O Valor é obrigatório`),months:g().int().positive().optional().default(1),referenceMonth:c().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),expectedDate:v({message:`A Data prevista é obrigatória`}),receivedDate:v().optional().nullable()});var z={description:``,amount:``,expectedDate:``,receivedDate:``,referenceMonth:``,months:1};function B({isOpen:e,onClose:t}){let{month:n,year:a}=C(),{create:s,isSaving:c}=w(n,String(a)),l=o(),{validate:u}=h(),{control:d,register:f,handleSubmit:p,reset:m,watch:g,setValue:_}=i({defaultValues:z});return(0,F.useEffect)(()=>{e||m(z)},[e,m]),(0,F.useEffect)(()=>{if(!e)return;let t=new Date,r=n===`all`?t.getMonth()+1:Number(n);_(`referenceMonth`,`${n===`all`?t.getFullYear():a}-${String(r).padStart(2,`0`)}`)},[e,n,a,_]),(0,I.jsx)(j,{isOpen:e,onClose:t,title:`Nova receita`,type:`create`,isLoading:c,loadingText:`Salvando...`,onSave:p(async e=>{let n=u(R,{description:e.description,amount:k(String(e.amount)),expectedDate:e.expectedDate,receivedDate:e.receivedDate?e.receivedDate:void 0,referenceMonth:e.referenceMonth,months:e.months});n&&(await s(n),l.success(`Receita criada com sucesso!`),m(z),t())}),children:(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,I.jsx)(`input`,{id:`income-description`,"aria-required":`true`,placeholder:`Ex: Salário, Venda de Produto`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                     dark:text-gray-100 rounded-md p-2`,...f(`description`)})]}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex-1`,children:[(0,I.jsx)(`label`,{htmlFor:`income-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,I.jsx)(r,{name:`amount`,control:d,render:({field:e})=>(0,I.jsx)(`input`,{id:`income-amount`,"aria-required":`true`,"aria-label":`Valor da receita em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,autoComplete:`off`,value:e.value,onChange:t=>e.onChange(D(t.target.value))})})]}),(0,I.jsxs)(`div`,{className:`w-30`,children:[(0,I.jsx)(`label`,{htmlFor:`income-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,I.jsx)(`input`,{id:`income-months`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md p-2`,...f(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,I.jsx)(r,{control:d,name:`referenceMonth`,render:({field:e})=>(0,I.jsx)(P,{value:e.value,onChange:e.onChange})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-expected-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data Prevista *`}),(0,I.jsx)(r,{control:d,name:`expectedDate`,render:({field:e})=>(0,I.jsx)(M,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-received-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de Recebimento (opcional)`}),(0,I.jsx)(r,{control:d,name:`receivedDate`,render:({field:e})=>(0,I.jsx)(M,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]})]})})}function V({isOpen:e,income:t,onClose:n}){let{month:r,year:i}=C(),{update:s,remove:c,isSaving:l,isDeleting:u}=w(r,String(i)),d=o(),[f,p]=(0,F.useState)(``),[m,h]=(0,F.useState)(``),[g,_]=(0,F.useState)(null),[v,y]=(0,F.useState)(null);(0,F.useEffect)(()=>{t&&(p(O(t.amount)),h(t.receivedDate?E(t.receivedDate):new Date().toISOString().slice(0,10)))},[t]);let b=async()=>{y(`update`),_(`edit`)},x=async e=>{await s({rowIndex:t.rowIndex,amount:k(f),receivedDate:m,scope:e}),d.success(`Receita atualizada com sucesso!`),p(``),h(``),n()},S=async()=>{y(`delete`),_(`delete`)},A=async e=>{await c({rowIndex:t.rowIndex,scope:e}),d.success(`Receita excluída com sucesso!`),n()};if(!t)return null;let P=l||u;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(j,{isOpen:e,onClose:n,title:t?.description,type:`edit`,isLoading:P,loadingText:l?`Salvando...`:`Excluindo...`,onSave:b,onDelete:S,children:(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`edit-income-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor`}),(0,I.jsx)(`input`,{id:`edit-income-amount`,"aria-label":`Valor da receita em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                        dark:text-gray-100 rounded-md p-2 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400`,value:f,onChange:e=>p(D(e.target.value))})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`edit-income-received-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de recebimento`}),(0,I.jsx)(M,{value:m?T(m):void 0,onChange:e=>{if(!e){h(``);return}h(a(e,`yyyy-MM-dd`))}})]})]})}),(0,I.jsx)(N,{isOpen:!!g,isDelete:g===`delete`,onClose:()=>{_(null),y(null)},onConfirm:e=>{_(null),v===`update`&&x(e),v===`delete`&&A(e)}})]})}function H(){let{month:e,year:t}=C(),{incomes:r,isLoading:i}=w(e,String(t)),o=n(),c=()=>o(`/`),[l,u]=(0,F.useState)(null),[d,f]=(0,F.useState)(!1),p=(0,F.useMemo)(()=>{let n=e===`all`?String(t):a(new Date(Number(t),Number(e)-1,1),`MMMM 'de' yyyy`,{locale:A});return`${e===`all`?n:n.charAt(0).toUpperCase()+n.slice(1)} • Total: ${O(r.reduce((e,t)=>e+Number(t.amount),0))}`},[e,t,r]);return i?(0,I.jsx)(s,{title:`Receitas`,onBack:c,headerVariant:`income`,children:(0,I.jsx)(b,{})}):(0,I.jsxs)(s,{title:`Receitas`,onBack:c,subtitle:p,headerVariant:`income`,children:[(0,I.jsx)(`div`,{className:`pt-1 pb-20`,children:(0,I.jsx)(L,{incomes:r,onSelect:u})}),(0,I.jsx)(`button`,{type:`button`,onClick:()=>f(!0),className:`fixed bottom-6 right-6 z-50 flex h-14 w-14 items-center justify-center rounded-full bg-emerald-600 text-white shadow-lg transition-all hover:bg-emerald-700 dark:bg-emerald-500 dark:hover:bg-emerald-600 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900`,"aria-label":`Nova receita`,children:(0,I.jsx)(S,{className:`h-7 w-7`})}),(0,I.jsx)(B,{isOpen:d,onClose:()=>f(!1)}),(0,I.jsx)(V,{isOpen:!!l,income:l,onClose:()=>u(null)})]})}export{H as default};