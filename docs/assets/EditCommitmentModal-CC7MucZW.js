import{T as e,w as t}from"./react-query-B5bzpzJa.js";import{o as n}from"./vendor-react-DA-XzSwC.js";import{C as r,E as i,S as a,_ as o,b as s,h as c,w as l,x as u}from"./index-Bp9Zd94y.js";import{r as d,t as f}from"./DateField-DFluzvmP.js";import{t as p}from"./ConfirmModal-D4efUdAp.js";import{t as m}from"./ScopeChoiceModal-EBDVPxn3.js";var h=e(),g=t();function _({isOpen:e,commitment:t,onClose:_,onConfirm:v}){let{month:y,year:b}=c(),{update:x,remove:S,isSaving:C,isDeleting:w}=o(y,String(b)),T=i(),[E,D]=(0,h.useState)(``),[O,k]=(0,h.useState)(``),[A,j]=(0,h.useState)(null),[M,N]=(0,h.useState)(null),[P,F]=(0,h.useState)(!1);(0,h.useEffect)(()=>{if(t){let e=t.paymentDate?u(t.paymentDate):new Date().toISOString().slice(0,10);D(r(t.amount)),k(e)}},[t]);let I=e=>{let t=e.type===`Fixo`,n=e.type===`Cartão`;if(t)return!0;let r=(e.totalInstallments??1)>1&&e.installment!==e.totalInstallments;return n&&r},L=async()=>{if(t){if(I(t)){N(`update`),j(`edit`);return}await R(`single`)}},R=async e=>{t&&(await x({rowIndex:t.rowIndex,amount:s(E),paymentDate:O,scope:e}),T.success(`Compromisso atualizado com sucesso!`),D(``),k(``),v(t.rowIndex),_())},z=async()=>{if(t){if(t.type===`Variável`){F(!0);return}if(I(t)){N(`delete`),j(`delete`);return}await B(`single`)}},B=async e=>{t&&(await S({rowIndex:t.rowIndex,scope:e}),T.success(`Compromisso excluído com sucesso!`),v(t.rowIndex),_())};return t?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(d,{isOpen:e,onClose:_,title:t.description,type:`edit`,isLoading:C||w,loadingText:w?`Excluindo...`:`Salvando...`,onSave:L,onDelete:z,children:(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`div`,{className:`-mt-4 grid grid-cols-2 gap-2 bg-muted/30 p-3 rounded-lg border border-dashed text-xs text-muted-foreground`,children:[(0,g.jsxs)(`div`,{children:[`Tipo: `,(0,g.jsx)(`span`,{className:`font-medium text-foreground`,children:t.type})]}),(0,g.jsxs)(`div`,{className:`justify-self-end`,children:[`Vencimento: `,(0,g.jsx)(`span`,{className:`font-medium text-foreground`,children:t.dueDate})]}),t.card&&(0,g.jsxs)(`div`,{className:`col-span-2`,children:[`Cartão: `,(0,g.jsx)(`span`,{className:`font-medium text-foreground`,children:t.card}),t.installment&&` (Parc. ${t.installment}/${t.totalInstallments})`]})]}),(0,g.jsxs)(`div`,{className:`grid grid-cols-1 gap-4`,children:[(0,g.jsxs)(`div`,{children:[(0,g.jsx)(`label`,{htmlFor:`edit-commitment-value`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Confirmar Valor`}),(0,g.jsx)(`input`,{id:`edit-commitment-value`,"aria-label":`Valor do compromisso em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                           dark:text-gray-100 rounded-md p-2`,value:E,onChange:e=>D(a(e.target.value))})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsx)(`label`,{htmlFor:`edit-commitment-payment-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de Pagamento`}),(0,g.jsx)(f,{value:O?l(O):void 0,onChange:e=>{if(!e){k(``);return}k(n(e,`yyyy-MM-dd`))}}),!t.paymentDate&&(0,g.jsx)(`p`,{className:`text-[10px] text-muted-foreground mt-1 italic`,children:`* Preencha para marcar este compromisso como pago.`})]})]})]})}),(0,g.jsx)(p,{isOpen:P,onClose:()=>F(!1),title:`Excluir compromisso`,message:`Tem certeza que deseja excluir este compromisso? Essa ação não poderá ser desfeita.`,confirmLabel:`Excluir`,onConfirm:()=>B(`single`),loading:w}),(0,g.jsx)(m,{isOpen:!!A,isDelete:A===`delete`,onClose:()=>{j(null),N(null)},onConfirm:e=>{j(null),M===`update`&&R(e),M===`delete`&&B(e)}})]}):null}export{_ as t};