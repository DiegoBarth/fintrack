const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommitmentsModal-D4fp3fT-.js","assets/index--ramNsmR.js","assets/vendor-react-g7Jl8uRT.js","assets/react-query-Bs2h8zdQ.js","assets/rolldown-runtime-DGruFWvd.js","assets/vendor-react-Chw94eNX.css","assets/index-1gQSlcTj.css","assets/calendar-Dng24LHl.js","assets/wallet-CI-qZMfA.js","assets/x-DEZ0eYOE.js","assets/formatters-QxNcvdBP.js","assets/EditCommitmentModal-eiT2GJKu.js","assets/pt-BR-CwF-q4-j.js","assets/commitmentQuery-DGrm84gF.js","assets/sanitizers-BTIJ-cE9.js","assets/ScopeChoiceModal-T42WM0t8.js","assets/BaseModal-gkdyOWux.js","assets/ConfirmModal-BvvvubRs.js","assets/DateField-BbN-VAiT.js","assets/queryInvalidationService-DKiaE9xh.js","assets/useCommitment-C3jvxXWf.js","assets/PayCardAlertModal-GwEaGcDc.js"])))=>i.map(i=>d[i]);
import{T as e,w as t}from"./react-query-Bs2h8zdQ.js";import{x as n}from"./vendor-react-g7Jl8uRT.js";import{E as r,O as i,b as a,g as o}from"./index--ramNsmR.js";import"./formatters-QxNcvdBP.js";import"./sanitizers-BTIJ-cE9.js";import"./commitmentQuery-DGrm84gF.js";import"./queryInvalidationService-DKiaE9xh.js";import{t as s}from"./useCommitment-C3jvxXWf.js";var c=e();function l(e){let t=new Date(e);return t.setHours(0,0,0,0),t}function u(){let{year:e}=o(),{alertCommitments:t}=s(`all`,String(e));return(0,c.useMemo)(()=>{let e=l(new Date),n=t.filter(e=>!e.paymentDate);return{overdue:n.filter(t=>{let[n,i,a]=t.dueDate.split(`/`).map(Number),o=l(new Date(a,i-1,n));return Math.ceil((o.getTime()-e.getTime())/r)<0}),today:n.filter(t=>{let[n,r,i]=t.dueDate.split(`/`).map(Number);return l(new Date(i,r-1,n)).getTime()===e.getTime()}),week:n.filter(t=>{let[n,i,a]=t.dueDate.split(`/`).map(Number),o=l(new Date(a,i-1,n)),s=Math.ceil((o.getTime()-e.getTime())/r);return s>0&&s<=7})}},[t])}function d(e){let t=new Map,n=[];for(let r of e)if(r.type===`Cartão`&&r.card){let e=t.get(r.card)??[];e.push(r),t.set(r.card,e)}else n.push({kind:`commitment`,commitment:r});for(let[e,r]of t){let t=r.reduce((e,t)=>e+Number(t.amount),0);n.push({kind:`cardGroup`,card:e,commitments:r,totalAmount:t})}return n}var f=t(),p=(0,c.lazy)(()=>n(()=>import(`./CommitmentsModal-D4fp3fT-.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(e=>({default:e.AlertsModal}))),m=(0,c.lazy)(()=>n(()=>import(`./EditCommitmentModal-eiT2GJKu.js`),__vite__mapDeps([11,1,2,3,4,5,6,12,9,13,14,15,16,17,18,19,20,10]))),h=(0,c.lazy)(()=>n(()=>import(`./PayCardAlertModal-GwEaGcDc.js`),__vite__mapDeps([21,1,2,3,4,5,6,8,10])).then(e=>({default:e.PayCardAlertModal})));function g({title:e,gradientFrom:t,gradientTo:n,onClick:r}){return(0,f.jsxs)(`button`,{onClick:r,className:`\r
            w-full text-left\r
            rounded-xl p-2 text-white\r
            flex items-center justify-between\r
            gap-2\r
            active:scale-[0.98] \r
            hover:scale-105 \r
            hover:shadow-lg\r
            transition-all \r
            duration-200\r
            group`,style:{background:`linear-gradient(135deg, ${t} 0%, ${n} 100%)`},children:[(0,f.jsx)(`h3`,{className:`text-sm font-medium text-white/90 truncate group-hover:text-white`,children:e}),(0,f.jsx)(`span`,{className:`text-xs opacity-80 whitespace-nowrap group-hover:opacity-100 group-hover:font-medium transition-all`,children:`Ver detalhes`})]})}function _(){let{year:e}=o(),t=a(),{overdue:n,today:r,week:i}=u(),{payCardStatement:l}=s(`all`,String(e)),[_,v]=(0,c.useState)(null),[y,b]=(0,c.useState)(null),[x,S]=(0,c.useState)(null),[C,w]=(0,c.useState)([]),[T,E]=(0,c.useState)(null),[D,O]=(0,c.useState)(!1),k=n.filter(e=>!C.includes(e.rowIndex)),A=r.filter(e=>!C.includes(e.rowIndex)),j=i.filter(e=>!C.includes(e.rowIndex)),M=d(k),N=d(A),P=d(j),F=M.length>0||N.length>0||P.length>0;function I(){T===`overdue`&&M.length>0&&v(`overdue`),T===`today`&&N.length>0&&v(`today`),T===`week`&&P.length>0&&v(`week`)}function L(e){w(t=>[...t,e]),b(null),setTimeout(I,0)}function R(e){w(t=>[...t,...e]),S(null),setTimeout(I,0)}let z=(0,c.useCallback)(async()=>{if(!(!x||x.kind!==`cardGroup`)){O(!0);try{await l({rowIndexes:x.commitments.map(e=>e.rowIndex),paymentDate:new Date().toISOString().slice(0,10)}),R(x.commitments.map(e=>e.rowIndex)),t.success(`Fatura do cartão paga com sucesso!`)}catch{}finally{O(!1)}}},[x,l,t]),B=(e,t,n)=>e===1?t:n;return F?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(`div`,{className:`grid gap-3 grid-cols-1 sm:grid-cols-[repeat(auto-fit,minmax(260px,1fr))] justify-center`,children:[M.length>0&&(0,f.jsx)(g,{title:`${M.length} ${B(M.length,`conta vencida`,`contas vencidas`)}`,gradientFrom:`#b91c1c`,gradientTo:`#dc2626`,onClick:()=>v(`overdue`)}),N.length>0&&(0,f.jsx)(g,{title:`${N.length} ${B(N.length,`conta vencendo hoje`,`contas vencendo hoje`)}`,gradientFrom:`#ea580c`,gradientTo:`#fb923c`,onClick:()=>v(`today`)}),P.length>0&&(0,f.jsx)(g,{title:`${P.length} ${B(P.length,`conta vencendo essa semana`,`contas vencendo essa semana`)}`,gradientFrom:`#0891b2`,gradientTo:`#22d3ee`,onClick:()=>v(`week`)})]}),(0,f.jsxs)(c.Suspense,{fallback:null,children:[_&&(0,f.jsx)(p,{isOpen:!!_,title:_===`overdue`?`Vencidos`:_===`today`?`Vencem hoje`:`Vencem essa semana`,items:_===`overdue`?M:_===`today`?N:P,onClose:()=>v(null),onSelect:e=>{E(_),v(null),e.kind===`cardGroup`?S(e):b(e.commitment)}}),y&&(0,f.jsx)(m,{isOpen:!!y,commitment:y,onClose:()=>{b(null),I()},onConfirm:L}),x&&x.kind===`cardGroup`&&(0,f.jsx)(h,{isOpen:!!x,cardName:x.card,totalAmount:x.totalAmount,isPaying:D,onClose:()=>{S(null),I()},onPay:z})]})]}):null}export{_ as default};