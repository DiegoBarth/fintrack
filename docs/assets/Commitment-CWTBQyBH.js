import{T as e,w as t}from"./react-query-B5bzpzJa.js";import{b as n,n as r,o as i,t as a}from"./vendor-react-DA-XzSwC.js";import{a as o,c as s,d as c,f as l,h as u,i as d,l as f,m as p,n as m,o as h,p as g,r as _,s as v,t as y,u as b}from"./useValidation-qnHrZkSo.js";import{t as x}from"./plus-D9KzV0mC.js";import{t as S}from"./wallet-De8C6BAd.js";import"./x-B-rujbE9.js";import{D as C,O as w,S as T,T as E,b as D,g as O,i as k,k as A,m as j,o as M,r as N,s as P,x as F,y as I}from"./index--IbD_1Ym.js";import{n as L,r as R,t as z}from"./DateField-DFluzvmP.js";import"./ConfirmModal-BFsQqkwP.js";import"./ScopeChoiceModal-EBDVPxn3.js";import{t as B}from"./EditCommitmentModal-BMaJGOfr.js";import{n as V,t as H}from"./CustomSelect-jT-_97Sc.js";import{t as U}from"./MonthField-DwqoartV.js";var W=e(),G=t();function K(e){let[t,n,r]=e.split(`/`).map(Number),i=new Date(r,n-1,t);i.setHours(0,0,0,0);let a=new Date;return a.setHours(0,0,0,0),i<a}const q=(0,W.memo)(function({commitments:e,onSelect:t}){return(0,G.jsx)(u,{itens:e,emptyText:`Nenhum compromisso cadastrado`,keyExtractor:e=>e.rowIndex,renderMobileItem:(0,W.useCallback)(e=>{let n=!!e.paymentDate,r=e.type===`Cartão`,i=!n&&K(e.dueDate);return(0,G.jsxs)(p,{onClick:()=>t(e),variant:n?`success`:i?`danger`:`warning`,className:`p-3`,children:[(0,G.jsx)(g,{title:e.description,right:T(e.amount)}),(0,G.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground ${r?`min-h-[1rem]`:``}`,children:r?(0,G.jsxs)(`span`,{children:[e.card,(e.totalInstallments??1)>1&&(0,G.jsxs)(G.Fragment,{children:[` • Parcela `,e.installment,`/`,e.totalInstallments]})]}):(0,G.jsx)(`span`,{children:e.type})}),(0,G.jsx)(l,{left:(0,G.jsxs)(`div`,{className:`flex flex-col text-xs mt-1`,children:[(0,G.jsxs)(`span`,{className:i?`text-red-700 dark:text-red-300`:`text-amber-700 dark:text-amber-400`,children:[`Vence em `,e.dueDate]}),(0,G.jsx)(`span`,{className:`text-green-700 dark:text-green-400 ${n?``:`invisible select-none`}`,children:n?`Pago em ${e.paymentDate}`:`Aguardando`})]}),right:(0,G.jsx)(`div`,{className:`flex flex-col items-end gap-1`,children:(0,G.jsx)(`span`,{className:`font-medium text-sm
                           ${n&&`text-green-700 dark:text-green-400`}
                           ${i&&`text-red-600 dark:text-red-400`}
                           ${!n&&!i&&`text-amber-700 dark:text-amber-400`}
                        `,children:n?`Pago`:i?`Vencido`:`Em aberto`})})})]})},[t]),renderDesktopItem:(0,W.useCallback)(e=>{let n=!!e.paymentDate,r=!n&&K(e.dueDate);return(0,G.jsxs)(c,{onClick:()=>t(e),variant:n?`success`:r?`danger`:`default`,children:[(0,G.jsx)(b,{children:e.description}),(0,G.jsx)(f,{span:2,children:e.type}),(0,G.jsx)(f,{span:2,children:(0,G.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400`:r?`text-red-700 dark:text-red-300`:`text-amber-700 dark:text-amber-400`,children:n?`Pago em ${e.paymentDate}`:`Vence em ${e.dueDate}`})}),(0,G.jsx)(s,{children:T(e.amount)}),(0,G.jsx)(V,{children:(0,G.jsx)(`span`,{className:`font-semibold
                     ${n&&`text-green-700 dark:text-green-400`}
                     ${r&&`text-red-600 dark:text-red-400`}
                     ${!n&&!r&&`text-amber-700 dark:text-amber-400`}
                  `,children:n?`Pago`:r?`Vencido`:`Aberto`})})]})},[t])})});function J(e){return[...e].sort((e,t)=>{let n=new Date(D(e.dueDate)).getTime(),r=new Date(D(t.dueDate)).getTime();if(n!==r)return n-r;let i=e.totalInstallments??1;return(t.totalInstallments??1)-i})}var Y=[`Fixo`,`Variável`,`Cartão`];const X=(0,W.memo)(function({commitments:e,onSelect:t,showStatementInGroupHeaders:n=!1}){let r=(0,W.useMemo)(()=>{let t={Fixo:[],Variável:[],Cartão:[]};for(let n of e){let e=n.type===`Fixo`||n.type===`Variável`||n.type===`Cartão`?n.type:`Variável`;t[e]&&t[e].push(n)}let n=[];for(let e of Y){let r=t[e];if(r.length===0)continue;if(e!==`Cartão`){n.push({type:e,items:r});continue}let i={};for(let e of r){let t=e.card||`Outros`;i[t]||(i[t]=[]),i[t].push(e)}for(let e of C){let t=i[e];t?.length&&n.push({type:`Cartão`,card:e,items:J(t)})}i.Outros?.length&&n.push({type:`Cartão`,card:`Outros`,items:J(i.Outros)})}return n},[e]);return r.length===0?(0,G.jsx)(q,{commitments:[],onSelect:()=>{}}):(0,G.jsx)(`div`,{className:`space-y-6`,children:r.map(e=>{e.type===`Cartão`&&e.card;let r=n?e.items.reduce((e,t)=>e+Number(t.amount),0):0;return(0,G.jsxs)(`section`,{"aria-labelledby":`group-${e.type}-${e.card??``}`,children:[(0,G.jsxs)(`h2`,{id:`group-${e.type}-${e.card??``}`,className:`text-sm font-semibold text-muted-foreground mb-2 px-0.5 flex flex-wrap items-baseline justify-between gap-2`,children:[(0,G.jsx)(`span`,{children:e.card?`${e.type} • ${e.card}`:e.type}),n&&r>0&&(0,G.jsx)(`span`,{className:`font-bold text-foreground text-base`,children:T(r)})]}),(0,G.jsx)(q,{commitments:e.items,onSelect:t})]},e.card?`${e.type}-${e.card}`:e.type)})})});function ee({value:e,onChange:t,className:n}){return(0,G.jsxs)(`div`,{className:P(`flex flex-wrap items-center gap-2`,n),role:`group`,"aria-label":`Filtrar por tipo`,children:[(0,G.jsx)(Z,{label:`Todos`,selected:e===null,onClick:()=>t(null)}),A.map(n=>(0,G.jsx)(Z,{label:n,selected:e===n,onClick:()=>t(n)},n))]})}function Z({label:e,selected:t,onClick:n}){return(0,G.jsx)(`button`,{type:`button`,onClick:n,className:P(`rounded-full px-3 py-1.5 text-sm font-medium transition-all duration-200`,`border focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background`,t?`bg-primary text-primary-foreground border-primary shadow-sm`:`bg-background border-border text-muted-foreground hover:bg-accent hover:text-accent-foreground hover:border-accent`),children:e})}function te({value:e,onChange:t,className:n}){return(0,G.jsxs)(`div`,{className:P(`flex flex-wrap items-center gap-2`,n),role:`group`,"aria-label":`Filtrar por cartão`,children:[(0,G.jsx)(Q,{label:`Todos`,selected:e===null,onClick:()=>t(null)}),C.map(n=>(0,G.jsx)(Q,{label:n,selected:e===n,onClick:()=>t(n)},n))]})}function Q({label:e,selected:t,onClick:n}){return(0,G.jsx)(`button`,{type:`button`,onClick:n,className:P(`rounded-full px-3 py-1.5 text-sm font-medium transition-all duration-200`,`border focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background`,t?`bg-primary text-primary-foreground border-primary shadow-sm`:`bg-background border-border text-muted-foreground hover:bg-accent hover:text-accent-foreground hover:border-accent`),children:e})}function ne({cardName:e,totalStatement:t,onPayStatement:n,isPaying:r,allPaid:i=!1}){return(0,G.jsxs)(`div`,{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-xl border border-border bg-card text-card-foreground shadow-sm`,role:`region`,"aria-label":`Fatura do cartão ${e}`,children:[(0,G.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,G.jsx)(`div`,{className:`flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary`,children:(0,G.jsx)(S,{className:`h-5 w-5`})}),(0,G.jsxs)(`div`,{children:[(0,G.jsxs)(`p`,{className:`text-sm font-medium text-muted-foreground`,children:[`Fatura `,e]}),(0,G.jsx)(`p`,{className:`text-xl font-bold text-foreground`,children:T(t)})]})]}),(0,G.jsx)(M,{onClick:n,disabled:r||i,className:i?`rounded-full bg-muted text-muted-foreground border border-border shrink-0 cursor-default`:`rounded-full bg-green-600 hover:bg-green-700 text-white border-0 shrink-0`,children:r?`Pagando…`:i?`Pago`:`Pagar fatura`})]})}const re=h({description:v().trim().min(1,`A Descrição é obrigatória`),category:v().min(1,`A Categoria é obrigatória`),type:_([`Fixo`,`Variável`,`Cartão`],{message:`O Tipo é obrigatório`}),referenceMonth:v().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:o().positive(`O Valor é obrigatório`),months:o().int().positive().optional().default(1),dueDate:m({message:`A Data de vencimento é obrigatória`})}),ie=h({description:v().trim().min(1,`A Descrição é obrigatória`),category:v().min(1,`A Categoria é obrigatória`),type:d(`Cartão`),card:v().min(1,`O Cartão é obrigatório`),referenceMonth:v().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),amount:o().positive(`O Valor é obrigatório`),totalInstallments:o().int(`As Parcelas devem ser um número inteiro`).positive(`As Parcelas devem ser um número positivo`),dueDate:m({message:`A Data de vencimento é obrigatória`})});var $={description:``,category:``,type:``,dueDate:``,months:1,card:``,amount:``,totalInstallments:1,referenceMonth:``};function ae({isOpen:e,onClose:t}){let{month:n,year:i}=j(),{create:o,createCard:s,isSaving:c}=O(n,String(i)),l=E(),{validate:u}=y(),{control:d,register:f,handleSubmit:p,watch:m,setValue:h,reset:g}=r({defaultValues:$}),_=m(`type`),v=m(`dueDate`);(0,W.useEffect)(()=>{_===`Fixo`&&v&&h(`months`,12-new Date(v).getMonth())},[_,v]),(0,W.useEffect)(()=>{e||g($)},[e,g]),(0,W.useEffect)(()=>{if(!e)return;let t=new Date,r=n===`all`?t.getMonth()+1:Number(n);h(`referenceMonth`,`${n===`all`?t.getFullYear():i}-${String(r).padStart(2,`0`)}`)},[e,n,i,h]);async function b(e){if(_===`Cartão`){let t=u(ie,{description:e.description,category:e.category,type:_,card:e.card,amount:I(String(e.amount)),totalInstallments:Number(e.totalInstallments),dueDate:e.dueDate,referenceMonth:e.referenceMonth});if(!t)return;await s(t),l.success(`Compromisso de cartão criado com sucesso!`)}else{let t=u(re,{description:e.description,category:e.category,type:_,amount:I(String(e.amount)),dueDate:e.dueDate,months:_===`Fixo`?e.months:1,referenceMonth:e.referenceMonth});if(!t)return;await o(t),l.success(`Compromisso criado com sucesso!`)}g($),t()}return(0,G.jsx)(R,{isOpen:e,onClose:t,title:`Novo compromisso`,type:`create`,isLoading:c,loadingText:`Salvando...`,onSave:p(b),children:(0,G.jsxs)(`div`,{className:`space-y-4`,children:[(0,G.jsxs)(`div`,{className:`grid grid-cols-1 gap-4`,children:[(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,G.jsx)(`input`,{id:`commitment-description`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                        dark:text-gray-100 rounded-md p-2`,placeholder:`Ex: Aluguel, Parcela Notebook`,...f(`description`)})]}),(0,G.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{id:`commitment-category-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Categoria *`}),(0,G.jsx)(a,{name:`category`,control:d,render:({field:e})=>(0,G.jsx)(H,{id:`commitment-category`,label:`Categoria`,value:e.value,onChange:e.onChange,options:w})})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{id:`commitment-type-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Tipo *`}),(0,G.jsx)(a,{name:`type`,control:d,render:({field:e})=>(0,G.jsx)(H,{id:`commitment-type`,label:`Tipo de compromisso`,value:e.value,onChange:t=>e.onChange(t),options:A})})]})]})]}),(0,G.jsx)(`hr`,{className:`border-dashed`}),(_===`Fixo`||_===`Variável`)&&(0,G.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,G.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,G.jsx)(a,{name:`amount`,control:d,render:({field:e})=>(0,G.jsx)(`input`,{...e,id:`commitment-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(F(t.target.value))})})]}),_===`Fixo`&&(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,G.jsx)(`input`,{id:`commitment-months`,"aria-label":`Número de meses para repetir o compromisso`,autoComplete:`off`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...f(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-due-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Vencimento *`}),(0,G.jsx)(a,{control:d,name:`dueDate`,render:({field:e})=>(0,G.jsx)(z,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,G.jsx)(a,{control:d,name:`referenceMonth`,render:({field:e})=>(0,G.jsx)(U,{value:e.value,onChange:e.onChange})})]})]}),_===`Cartão`&&(0,G.jsxs)(`div`,{className:`space-y-4 animate-in fade-in slide-in-from-top-2`,children:[(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{id:`commitment-card-label`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Selecione o Cartão *`}),(0,G.jsx)(a,{name:`card`,control:d,render:({field:e})=>(0,G.jsx)(H,{id:`commitment-card`,label:`Cartão de crédito`,value:e.value??``,onChange:e.onChange,options:C})})]}),(0,G.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-total-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor Total *`}),(0,G.jsx)(a,{name:`amount`,control:d,render:({field:e})=>(0,G.jsx)(`input`,{id:`commitment-total-amount`,"aria-required":`true`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                                    dark:text-gray-100 rounded-md p-2`,value:e.value,onChange:t=>e.onChange(F(t.target.value))})})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{htmlFor:`commitment-total-installments`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Parcelas *`}),(0,G.jsx)(`input`,{id:`compromisso-total-parcelas`,min:1,max:60,"aria-required":`true`,autoComplete:`off`,"aria-label":`Total de parcelas do compromisso`,type:`number`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,...f(`totalInstallments`)})]})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Primeiro Vencimento *`}),(0,G.jsx)(a,{control:d,name:`dueDate`,render:({field:e})=>(0,G.jsx)(z,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,G.jsxs)(`div`,{children:[(0,G.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,G.jsx)(a,{control:d,name:`referenceMonth`,render:({field:e})=>(0,G.jsx)(U,{value:e.value,onChange:e.onChange})})]})]})]})})}function oe(){let{month:e,year:t}=j(),{commitments:r,isLoading:a,payCardStatement:o}=O(e,String(t)),[s,c]=(0,W.useState)(null),[l,u]=(0,W.useState)(!1),[d,f]=(0,W.useState)(null),[p,m]=(0,W.useState)(null),[h,g]=(0,W.useState)(!1),_=n(),v=()=>_(`/`),y=(0,W.useCallback)(e=>{f(e),e!==`Cartão`&&m(null)},[]),b=(0,W.useMemo)(()=>{let e=r;return d&&(e=e.filter(e=>e.type===d)),d===`Cartão`&&p&&(e=e.filter(e=>e.card===p)),e},[r,d,p]),S=(0,W.useMemo)(()=>b.filter(e=>!e.paymentDate),[b]),C=(0,W.useMemo)(()=>b.reduce((e,t)=>e+Number(t.amount),0),[b]),w=S.length===0,E=(0,W.useMemo)(()=>{let n=e===`all`?String(t):i(new Date(Number(t),Number(e)-1,1),`MMMM 'de' yyyy`,{locale:L});return`${e===`all`?n:n.charAt(0).toUpperCase()+n.slice(1)} • Total: ${T(b.reduce((e,t)=>e+Number(t.amount),0))}`},[e,t,b]),D=(0,W.useCallback)(async()=>{if(S.length===0)return;let e=new Date().toISOString().slice(0,10);g(!0);try{await o({rowIndexes:S.map(e=>e.rowIndex),paymentDate:e})}catch{}finally{g(!1)}},[S,o]);return a?(0,G.jsx)(k,{title:`Compromissos`,onBack:v,headerVariant:`commitment`,children:(0,G.jsx)(N,{})}):(0,G.jsxs)(k,{title:`Compromissos`,onBack:v,subtitle:E,headerVariant:`commitment`,children:[(0,G.jsxs)(`div`,{className:`space-y-4 pb-20`,children:[(0,G.jsxs)(`div`,{className:`space-y-3 pb-3 border-b border-border`,children:[(0,G.jsx)(ee,{value:d,onChange:y}),d===`Cartão`&&(0,G.jsx)(te,{value:p,onChange:m})]}),d===`Cartão`&&p&&(0,G.jsx)(ne,{cardName:p,totalStatement:C,onPayStatement:D,isPaying:h,allPaid:w}),(0,G.jsx)(X,{commitments:b,onSelect:c,showStatementInGroupHeaders:!p})]}),(0,G.jsx)(`button`,{type:`button`,onClick:()=>u(!0),className:`fixed bottom-6 right-6 z-50 flex h-14 w-14 items-center justify-center rounded-full bg-amber-600 text-white shadow-lg transition-all hover:bg-amber-700 dark:bg-amber-500 dark:hover:bg-amber-600 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900`,"aria-label":`Novo compromisso`,children:(0,G.jsx)(x,{className:`h-7 w-7`})}),(0,G.jsx)(ae,{isOpen:l,onClose:()=>u(!1)}),(0,G.jsx)(B,{isOpen:!!s,commitment:s,onClose:()=>c(null),onConfirm:()=>{}})]})}export{oe as default};