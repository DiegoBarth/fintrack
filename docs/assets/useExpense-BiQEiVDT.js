import{i as e,n as t,t as n}from"./react-query-Bs2h8zdQ.js";import{i as r,n as i}from"./formatters-QxNcvdBP.js";import{n as a,t as o}from"./queryInvalidationService-o1kf90pd.js";import{a as s,i as c,n as l,r as u,t as d}from"./expenseQuery-ng3pkdV2.js";function f(e,t,n){e.setQueryData(d(n),e=>(e?[...e,t]:[t]).sort((e,t)=>{let n=new Date(i(e.paymentDate)),r=new Date(i(t.paymentDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()})),o(e)}function p(e,t,n,r){e.setQueryData(d(r),e=>e?.map(e=>e.rowIndex===t.rowIndex?{...e,...n}:e)??[]),o(e)}function m(e,t,n){let r=t.rowIndex;e.setQueryData(d(n),e=>e?e.filter(e=>e.rowIndex!==r).map(e=>({...e,rowIndex:e.rowIndex>r?e.rowIndex-1:e.rowIndex})).sort((e,t)=>{let n=new Date(i(e.paymentDate)),r=new Date(i(t.paymentDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()}):[]),o(e)}function h(i,o){let d=e(),{handleError:h}=a(),{data:g=[],isLoading:_,isError:v}=t(l(o)),y=i===`all`?g:g.filter(e=>{let{month:t}=r(e.paymentDate);return String(t)===String(i)}),b=n({mutationFn:e=>u(e),onSuccess:e=>{let{year:t}=r(e.paymentDate);f(d,e,t)},onError:h}),x=n({mutationFn:e=>s(e),onSuccess:e=>{let{year:t}=r(e.paymentDate),n=d.getQueryData([`expenses`,t])?.find(t=>t.rowIndex===e.rowIndex);n&&p(d,n,e,t)},onError:h}),S=n({mutationFn:e=>c(e),onSuccess:(e,t)=>{let n=g.find(e=>e.rowIndex===t);if(n){let{year:e}=r(n.paymentDate);m(d,n,e)}},onError:h});return{expenses:y,isLoading:_,isError:v,create:b.mutateAsync,update:x.mutateAsync,remove:S.mutateAsync,isSaving:b.isPending||x.isPending,isDeleting:S.isPending}}export{h as t};