import{T as e,w as t}from"./react-query-Bs2h8zdQ.js";import{l as n,u as r}from"./vendor-react-g7Jl8uRT.js";import{b as i,g as a}from"./index-CrEqE7_v.js";import{r as o,t as s}from"./formatters-p9cTN3zd.js";import{t as c}from"./ModalBase-CvZekacX.js";import"./sanitizers-BTIJ-cE9.js";import"./queryInvalidationService-BxMLaNui.js";import{a as l,n as u,o as d,s as f,t as p}from"./useValidation-C5DCKG1X.js";import"./pt-BR-CwF-q4-j.js";import{t as m}from"./DateField-BbN-VAiT.js";import{t as h}from"./MonthField-BPD2zaMv.js";import"./incomeQuery-CnVeQLqq.js";import{t as g}from"./useIncome-C5ctNiUH.js";var _=e();const v=d({description:f().trim().min(1,`A Descrição é obrigatória`),amount:l().positive(`O Valor é obrigatório`),months:l().int().positive().optional().default(1),referenceMonth:f().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),expectedDate:u({message:`A Data prevista é obrigatória`}),receivedDate:u().optional().nullable()});var y=t(),b={description:``,amount:``,expectedDate:``,receivedDate:``,referenceMonth:``,months:1};function x({isOpen:e,onClose:t}){let{month:l,year:u}=a(),{create:d,isSaving:f}=g(l,String(u)),x=i(),{validate:S}=p(),{control:C,register:w,handleSubmit:T,reset:E,watch:D,setValue:O}=r({defaultValues:b});return(0,_.useEffect)(()=>{e||E(b)},[e,E]),(0,_.useEffect)(()=>{if(!e)return;let t=new Date,n=l===`all`?t.getMonth()+1:Number(l);O(`referenceMonth`,`${l===`all`?t.getFullYear():u}-${String(n).padStart(2,`0`)}`)},[e,l,u,O]),(0,y.jsx)(c,{isOpen:e,onClose:t,title:`Nova receita`,type:`create`,isLoading:f,loadingText:`Salvando...`,onSave:T(async e=>{let n=S(v,{description:e.description,amount:s(String(e.amount)),expectedDate:e.expectedDate,receivedDate:e.receivedDate?e.receivedDate:void 0,referenceMonth:e.referenceMonth,months:e.months});n&&(await d(n),x.success(`Receita criada com sucesso!`),E(b),t())}),children:(0,y.jsxs)(`div`,{className:`space-y-4`,children:[(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`label`,{htmlFor:`income-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,y.jsx)(`input`,{id:`income-description`,"aria-required":`true`,placeholder:`Ex: Salário, Venda de Produto`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                     dark:text-gray-100 rounded-md p-2`,...w(`description`)})]}),(0,y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,y.jsxs)(`div`,{className:`flex-1`,children:[(0,y.jsx)(`label`,{htmlFor:`income-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,y.jsx)(n,{name:`amount`,control:C,render:({field:e})=>(0,y.jsx)(`input`,{id:`income-amount`,"aria-required":`true`,"aria-label":`Valor da receita em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,autoComplete:`off`,value:e.value,onChange:t=>e.onChange(o(t.target.value))})})]}),(0,y.jsxs)(`div`,{className:`w-30`,children:[(0,y.jsx)(`label`,{htmlFor:`income-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,y.jsx)(`input`,{id:`income-months`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md p-2`,...w(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,y.jsx)(n,{control:C,name:`referenceMonth`,render:({field:e})=>(0,y.jsx)(h,{value:e.value,onChange:e.onChange})})]}),(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`label`,{htmlFor:`income-expected-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data Prevista *`}),(0,y.jsx)(n,{control:C,name:`expectedDate`,render:({field:e})=>(0,y.jsx)(m,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`label`,{htmlFor:`income-received-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de Recebimento (opcional)`}),(0,y.jsx)(n,{control:C,name:`receivedDate`,render:({field:e})=>(0,y.jsx)(m,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]})]})})}export{x as default};