import{i as e,n as t,t as n}from"./react-query-Bs2h8zdQ.js";import{a as r,n as i,s as a}from"./formatters-QxNcvdBP.js";import{n as o,t as s}from"./queryInvalidationService-CcomgyDE.js";import{a as c,i as l,n as u,r as d,t as f}from"./incomeQuery-DbFbo0LU.js";function p(e,t,n){e.setQueryData(u(n),e=>(e?[...e,t]:[t]).sort((e,t)=>{let n=new Date(i(e.expectedDate)),r=new Date(i(t.expectedDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()})),s(e)}function m(e,t,n,r){e.setQueryData(u(r),e=>e?.map(e=>e.rowIndex===t.rowIndex?{...e,...n}:e)??[]),s(e)}function h(e,t,n){e.setQueryData(u(n),e=>{if(!e)return[];let n=new Set(t.map(e=>e.rowIndex));return e.filter(e=>!n.has(e.rowIndex)).map(e=>{let n=t.filter(t=>t.rowIndex<e.rowIndex).length;return{...e,rowIndex:e.rowIndex-n}}).sort((e,t)=>{let n=new Date(i(e.expectedDate)),r=new Date(i(t.expectedDate));return n.getTime()===r.getTime()?e.description.localeCompare(t.description):n.getTime()-r.getTime()})}),s(e)}function g(s,u){let g=e(),{handleError:_}=o(),{data:v=[],isLoading:y,isError:b}=t(f(u)),x=s===`all`?v:v.filter(e=>{let{month:t}=r(e.referenceMonth);return String(t)===String(s)}),S=n({mutationFn:e=>d(e),onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth);p(g,e,t)})},onError:_}),C=n({mutationFn:e=>c(e),onSuccess:e=>{e.forEach(e=>{let{year:t}=r(e.referenceMonth),n=g.getQueryData([`incomes`,t])?.find(t=>t.rowIndex===e.rowIndex);n&&m(g,n,e,t)})},onError:_}),w=n({mutationFn:e=>typeof e==`number`?l(e):l(e.rowIndex,e.scope),onSuccess:(e,t)=>{let n=typeof t==`number`?t:t.rowIndex,o=typeof t==`number`?`single`:t.scope,s=v.find(e=>e.rowIndex===n);if(!s)return;let c=o===`future`?(()=>{let e=new Date(a(i(s.expectedDate)));return v.filter(t=>t.description===s.description&&new Date(a(i(t.expectedDate)))>=e)})():[s],l=new Map;c.forEach(e=>{let{year:t}=r(e.referenceMonth),n=l.get(t)??[];n.push(e),l.set(t,n)}),l.forEach((e,t)=>{h(g,e,t)})},onError:_});return{incomes:x,isLoading:y,isError:b,create:S.mutateAsync,update:C.mutateAsync,remove:w.mutateAsync,isSaving:S.isPending||C.isPending,isDeleting:w.isPending}}export{g as t};