import{T as e,w as t}from"./react-query-B5bzpzJa.js";import{b as n,n as r,o as i,t as a}from"./vendor-react-DA-XzSwC.js";import{a as o,c as s,d as c,f as l,h as u,l as d,m as f,n as p,o as m,p as h,s as g,t as _,u as v}from"./useValidation-qnHrZkSo.js";import{t as y}from"./plus-D9KzV0mC.js";import{C as b,S as x,T as S,b as C,i as w,m as T,r as E,v as D,x as O,y as k}from"./index--IbD_1Ym.js";import{n as A,r as j,t as M}from"./DateField-DFluzvmP.js";import{t as N}from"./ScopeChoiceModal-EBDVPxn3.js";import{t as P}from"./MonthField-DwqoartV.js";var F=e(),I=t();const L=(0,F.memo)(function({incomes:e,onSelect:t}){return(0,I.jsx)(u,{itens:e,emptyText:`Nenhuma receita cadastrada`,keyExtractor:e=>e.rowIndex,renderMobileItem:(0,F.useCallback)(e=>{let n=!!e.receivedDate;return(0,I.jsxs)(f,{onClick:()=>t(e),variant:n?`success`:`default`,className:`p-3`,children:[(0,I.jsx)(h,{title:e.description,right:x(e.amount)}),(0,I.jsx)(l,{left:(0,I.jsxs)(`div`,{className:`flex flex-col text-xs min-h-[32px] justify-center gap-1`,children:[e.expectedDate&&(0,I.jsxs)(`span`,{className:`text-blue-700 dark:text-blue-300`,children:[`Previsto para `,e.expectedDate]}),e.receivedDate?(0,I.jsxs)(`span`,{className:`text-green-700 dark:text-green-300`,children:[`Recebido em `,e.receivedDate]}):(0,I.jsx)(`span`,{className:`invisible select-none`,children:`Espaçador`})]}),right:(0,I.jsx)(`div`,{className:`flex flex-col items-end gap-1`,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400 font-medium`:`text-blue-700 dark:text-blue-400 font-medium`,children:n?`Recebido`:`Em aberto`})})})]})},[t]),renderDesktopItem:(0,F.useCallback)(e=>{let n=!!e.receivedDate,r=n?`Recebido em ${e.receivedDate}`:`Previsto para ${e.expectedDate}`;return(0,I.jsxs)(c,{onClick:()=>t(e),variant:n?`success`:`default`,children:[(0,I.jsx)(v,{children:e.description}),(0,I.jsx)(d,{span:4,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-300`:`text-blue-700 dark:text-blue-300`,children:r})}),(0,I.jsx)(s,{children:x(e.amount)}),(0,I.jsx)(`div`,{className:`col-span-2 text-right flex justify-end items-center gap-2`,children:(0,I.jsx)(`span`,{className:n?`text-green-700 dark:text-green-400 font-semibold`:`text-blue-700 dark:text-blue-400 font-semibold`,children:n?`Recebido`:`Em aberto`})})]})},[t])})}),R=m({description:g().trim().min(1,`A Descrição é obrigatória`),amount:o().positive(`O Valor é obrigatório`),months:o().int().positive().optional().default(1),referenceMonth:g().regex(/^\d{4}-(0[1-9]|1[0-2])$/,`Mês de referência inválido`),expectedDate:p({message:`A Data prevista é obrigatória`}),receivedDate:p().optional().nullable()});var z={description:``,amount:``,expectedDate:``,receivedDate:``,referenceMonth:``,months:1};function B({isOpen:e,onClose:t}){let{month:n,year:i}=T(),{create:o,isSaving:s}=D(n,String(i)),c=S(),{validate:l}=_(),{control:u,register:d,handleSubmit:f,reset:p,watch:m,setValue:h}=r({defaultValues:z});return(0,F.useEffect)(()=>{e||p(z)},[e,p]),(0,F.useEffect)(()=>{if(!e)return;let t=new Date,r=n===`all`?t.getMonth()+1:Number(n);h(`referenceMonth`,`${n===`all`?t.getFullYear():i}-${String(r).padStart(2,`0`)}`)},[e,n,i,h]),(0,I.jsx)(j,{isOpen:e,onClose:t,title:`Nova receita`,type:`create`,isLoading:s,loadingText:`Salvando...`,onSave:f(async e=>{let n=l(R,{description:e.description,amount:k(String(e.amount)),expectedDate:e.expectedDate,receivedDate:e.receivedDate?e.receivedDate:void 0,referenceMonth:e.referenceMonth,months:e.months});n&&(await o(n),c.success(`Receita criada com sucesso!`),p(z),t())}),children:(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-description`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Descrição *`}),(0,I.jsx)(`input`,{id:`income-description`,"aria-required":`true`,placeholder:`Ex: Salário, Venda de Produto`,autoComplete:`off`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                     dark:text-gray-100 rounded-md p-2`,...d(`description`)})]}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex-1`,children:[(0,I.jsx)(`label`,{htmlFor:`income-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor *`}),(0,I.jsx)(a,{name:`amount`,control:u,render:({field:e})=>(0,I.jsx)(`input`,{id:`income-amount`,"aria-required":`true`,"aria-label":`Valor da receita em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                              dark:text-gray-100 rounded-md p-2`,autoComplete:`off`,value:e.value,onChange:t=>e.onChange(O(t.target.value))})})]}),(0,I.jsxs)(`div`,{className:`w-30`,children:[(0,I.jsx)(`label`,{htmlFor:`income-months`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Repetir por (meses)`}),(0,I.jsx)(`input`,{id:`income-months`,type:`number`,min:1,max:12,pattern:`[0-9]*`,inputMode:`numeric`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md p-2`,...d(`months`,{valueAsNumber:!0,validate:e=>e!==void 0&&Number.isInteger(e)&&e>0&&e<=12}),onInput:e=>{let t=e.target;t.value=t.value.replace(/[^\d]/g,``),t.value&&Number(t.value)<1&&(t.value=`1`),t.value&&Number(t.value)>12&&(t.value=`12`)}})]})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Mês de Referência *`}),(0,I.jsx)(a,{control:u,name:`referenceMonth`,render:({field:e})=>(0,I.jsx)(P,{value:e.value,onChange:e.onChange})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-expected-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data Prevista *`}),(0,I.jsx)(a,{control:u,name:`expectedDate`,render:({field:e})=>(0,I.jsx)(M,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`income-received-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de Recebimento (opcional)`}),(0,I.jsx)(a,{control:u,name:`receivedDate`,render:({field:e})=>(0,I.jsx)(M,{value:e.value?new Date(e.value):void 0,onChange:t=>e.onChange(t)})})]})]})})}function V({isOpen:e,income:t,onClose:n}){let{month:r,year:a}=T(),{update:o,remove:s,isSaving:c,isDeleting:l}=D(r,String(a)),u=S(),[d,f]=(0,F.useState)(``),[p,m]=(0,F.useState)(``),[h,g]=(0,F.useState)(null),[_,v]=(0,F.useState)(null);(0,F.useEffect)(()=>{t&&(f(x(t.amount)),m(t.receivedDate?C(t.receivedDate):new Date().toISOString().slice(0,10)))},[t]);let y=async()=>{v(`update`),g(`edit`)},w=async e=>{await o({rowIndex:t.rowIndex,amount:k(d),receivedDate:p,scope:e}),u.success(`Receita atualizada com sucesso!`),f(``),m(``),n()},E=async()=>{v(`delete`),g(`delete`)},A=async e=>{await s({rowIndex:t.rowIndex,scope:e}),u.success(`Receita excluída com sucesso!`),n()};if(!t)return null;let P=c||l;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(j,{isOpen:e,onClose:n,title:t?.description,type:`edit`,isLoading:P,loadingText:c?`Salvando...`:`Excluindo...`,onSave:y,onDelete:E,children:(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`edit-income-amount`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Valor`}),(0,I.jsx)(`input`,{id:`edit-income-amount`,"aria-label":`Valor da receita em reais`,className:`w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900\r
                        dark:text-gray-100 rounded-md p-2 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400`,value:d,onChange:e=>f(O(e.target.value))})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`label`,{htmlFor:`edit-income-received-date`,className:`block text-xs font-medium text-muted-foreground mb-1`,children:`Data de recebimento`}),(0,I.jsx)(M,{value:p?b(p):void 0,onChange:e=>{if(!e){m(``);return}m(i(e,`yyyy-MM-dd`))}})]})]})}),(0,I.jsx)(N,{isOpen:!!h,isDelete:h===`delete`,onClose:()=>{g(null),v(null)},onConfirm:e=>{g(null),_===`update`&&w(e),_===`delete`&&A(e)}})]})}function H(){let{month:e,year:t}=T(),{incomes:r,isLoading:a}=D(e,String(t)),o=n(),s=()=>o(`/`),[c,l]=(0,F.useState)(null),[u,d]=(0,F.useState)(!1),f=(0,F.useMemo)(()=>{let n=e===`all`?String(t):i(new Date(Number(t),Number(e)-1,1),`MMMM 'de' yyyy`,{locale:A});return`${e===`all`?n:n.charAt(0).toUpperCase()+n.slice(1)} • Total: ${x(r.reduce((e,t)=>e+Number(t.amount),0))}`},[e,t,r]);return a?(0,I.jsx)(w,{title:`Receitas`,onBack:s,headerVariant:`income`,children:(0,I.jsx)(E,{})}):(0,I.jsxs)(w,{title:`Receitas`,onBack:s,subtitle:f,headerVariant:`income`,children:[(0,I.jsx)(`div`,{className:`pt-1 pb-20`,children:(0,I.jsx)(L,{incomes:r,onSelect:l})}),(0,I.jsx)(`button`,{type:`button`,onClick:()=>d(!0),className:`fixed bottom-6 right-6 z-50 flex h-14 w-14 items-center justify-center rounded-full bg-emerald-600 text-white shadow-lg transition-all hover:bg-emerald-700 dark:bg-emerald-500 dark:hover:bg-emerald-600 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900`,"aria-label":`Nova receita`,children:(0,I.jsx)(y,{className:`h-7 w-7`})}),(0,I.jsx)(B,{isOpen:u,onClose:()=>d(!1)}),(0,I.jsx)(V,{isOpen:!!c,income:c,onClose:()=>l(null)})]})}export{H as default};